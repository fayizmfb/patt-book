{% extends "base.html" %}

{% block title %}{{ customer['name'] }} - Patt Book{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <div>
            <h2>{{ customer['name'] }}</h2>
            <p style="color: #666; margin: 5px 0;">{{ customer['phone'] }}</p>
        </div>
        <div style="text-align: right;">
            <div style="font-size: 18px; font-weight: bold; color: {% if outstanding > 0 %}#e74c3c{% else %}#27ae60{% endif %}">
                Outstanding: â‚¹{{ "%.2f"|format(outstanding) }}
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 30px;">
        <a href="{{ url_for('add_credit', customer_id=customer['id']) }}" class="btn btn-success">
            ðŸ’° Add Credit
        </a>
        <a href="{{ url_for('submit_payment') }}" class="btn btn-primary">
            ðŸ’³ Record Payment
        </a>
    </div>

    <!-- Timeline -->
    <h3>Activity Timeline</h3>
    {% if timeline %}
    <div class="timeline">
        {% for event in timeline %}
        <div class="timeline-item">
            <div class="timeline-marker {{ event['event_type'] }}"></div>
            <div class="timeline-content">
                <div class="timeline-header">
                    <strong>{{ event['event_type'].replace('_', ' ').title() }}</strong>
                    <span class="timeline-date">{{ event['created_at'][:16] }}</span>
                </div>
                {% if event['amount'] %}
                <div class="timeline-amount">â‚¹{{ "%.2f"|format(event['amount']) }}</div>
                {% endif %}
                {% if event['description'] %}
                <div class="timeline-description">{{ event['description'] }}</div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center; padding: 40px; color: #666;">
        <p>No activity yet. Start by adding a credit entry!</p>
    </div>
    {% endif %}

    <div class="actions" style="margin-top: 30px;">
        <a href="{{ url_for('retailer_customers') }}" class="btn">Back to Customers</a>
    </div>
</div>

<style>
.timeline {
    position: relative;
    padding-left: 30px;
}

.timeline::before {
    content: '';
    position: absolute;
    left: 15px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: #e9ecef;
}

.timeline-item {
    position: relative;
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 1px solid #f8f9fa;
}

.timeline-item:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.timeline-marker {
    position: absolute;
    left: -22px;
    top: 5px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid #fff;
}

.timeline-marker.credit_added { background: #e74c3c; }
.timeline-marker.payment_requested { background: #f39c12; }
.timeline-marker.payment_confirmed { background: #27ae60; }
.timeline-marker.payment_rejected { background: #95a5a6; }

.timeline-content {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
}

.timeline-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.timeline-date {
    color: #666;
    font-size: 14px;
}

.timeline-amount {
    font-size: 18px;
    font-weight: bold;
    color: #2c3e50;
    margin: 5px 0;
}

.timeline-description {
    color: #666;
    font-style: italic;
}
</style>
{% endblock %}