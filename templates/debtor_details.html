{% extends "base.html" %}

{% block title %}Debtor Details - Retail App{% endblock %}

{% block extra_css %}
<style>
    /* Checkbox styling for better appearance */
    .debtor-checkbox {
        width: 20px;
        height: 20px;
        cursor: pointer;
        accent-color: #3498db;
    }
    
    /* Balance and days overdue display - stacked vertically */
    .balance-days-container {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 5px;
    }
    
    .outstanding-balance {
        font-weight: bold;
        color: #e74c3c;
        font-size: 16px;
    }
    
    .days-overdue-text {
        font-size: 13px;
        color: #666;
    }
    
    /* Overdue row styling */
    .overdue-row {
        background-color: #fff5f5;
    }
    
    .overdue-row:hover {
        background-color: #ffeaea;
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
        <h2>Debtor Details</h2>
        
        <!-- Sort Options -->
        <div>
            <label for="sort_select" style="margin-right: 10px; font-weight: 600;">Sort by:</label>
            <select id="sort_select" onchange="window.location.href='{{ url_for('debtor_details') }}?sort=' + this.value" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                <option value="due_asc" {% if sort_option == 'due_asc' %}selected{% endif %}>Due Date (Soonest First)</option>
                <option value="due_desc" {% if sort_option == 'due_desc' %}selected{% endif %}>Due Date (Latest First)</option>
                <option value="balance_desc" {% if sort_option == 'balance_desc' %}selected{% endif %}>Balance (High to Low)</option>
                <option value="balance_asc" {% if sort_option == 'balance_asc' %}selected{% endif %}>Balance (Low to High)</option>
                <option value="name_asc" {% if sort_option == 'name_asc' %}selected{% endif %}>Name (A-Z)</option>
                <option value="name_desc" {% if sort_option == 'name_desc' %}selected{% endif %}>Name (Z-A)</option>
            </select>
        </div>
    </div>
    
    <p style="color: #666; margin-bottom: 20px;">
        Showing all customers with outstanding balances > 0 (as of {{ today }})
        <br><small>Overdue accounts are highlighted in red</small>
    </p>
    
    {% if debtor_list %}
    <table>
        <thead>
            <tr>
                <th style="width: 40px;">
                    <!-- Checkbox column header (optional) -->
                </th>
                <th>Customer Name</th>
                <th>Phone</th>
                <th class="text-right">Outstanding Balance</th>
                <th>Due Date</th>
                <th>Status</th>
                <th>Ageing Bucket</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for debtor in debtor_list %}
            <tr class="{% if debtor['status'] == 'overdue' %}overdue-row{% endif %}">
                <!-- Checkbox column: Optional selection for future actions -->
                <td style="text-align: center;">
                    <input type="checkbox" 
                           class="debtor-checkbox" 
                           name="selected_debtor" 
                           value="{{ debtor['customer_name'] }}"
                           aria-label="Select {{ debtor['customer_name'] }}">
                </td>
                
                <!-- Customer name column -->
                <td>
                    <strong>{{ debtor['customer_name'] }}</strong>
                    {% if debtor['overdue_count'] > 0 %}
                        <br><small style="color: #e74c3c;">{{ debtor['overdue_count'] }} overdue credit(s)</small>
                    {% endif %}
                </td>
                
                <!-- Phone column -->
                <td>{{ debtor['phone'] or 'N/A' }}</td>
                
                <!-- Outstanding balance column -->
                <td class="text-right">
                    <div class="outstanding-balance">
                        {{ "%.2f"|format(debtor['outstanding_balance']) }}
                    </div>
                </td>
                
                <!-- Due date column -->
                <td>{{ debtor['due_date'] }}</td>
                
                <!-- Status column -->
                <td>
                    {% if debtor['status'] == 'overdue' %}
                        <span class="badge badge-danger">OVERDUE</span>
                    {% else %}
                        <span class="badge" style="background-color: #27ae60; color: white;">CURRENT</span>
                    {% endif %}
                </td>
                
                <!-- Ageing bucket column -->
                <td>
                    <span class="badge {% if debtor['status'] == 'overdue' %}badge-danger{% else %}badge-warning{% endif %}">
                        {{ debtor['bucket'] }}
                    </span>
                </td>
                
                <!-- Actions column -->
                <td>
                    <a href="{{ url_for('add_payment', customer_id=debtor['customer_id']) }}" 
                       class="btn btn-success btn-sm" 
                       style="padding: 6px 12px; font-size: 12px;">
                        ðŸ’° Pay
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; padding: 40px; color: #666;">
        No customers with outstanding balances found. All accounts are settled!
    </p>
    {% endif %}
    
    <div class="actions" style="margin-top: 20px;">
        <a href="{{ url_for('dashboard') }}" class="btn">Back to Dashboard</a>
    </div>
</div>
{% endblock %}

